{
	"info": {
		"_postman_id": "vitrinnea-auth-sync-api",
		"name": "Vitrinnea Auth - User Sync API",
		"description": "Collection for testing the User Sync API endpoint",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Sync User - Create New",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"if (pm.response.code === 201 || pm.response.code === 200) {",
							"    var jsonData = pm.response.json();",
							"    if (jsonData.success && jsonData.data.access_token) {",
							"        pm.environment.set(\"jwt_token\", jsonData.data.access_token);",
							"        console.log(\"✅ Token saved:\", jsonData.data.access_token);",
							"    }",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					},
					{
						"key": "X-API-Key",
						"value": "vitrinnea-dev-api-key-2025",
						"type": "text"
					},
					{
						"key": "X-API-Secret",
						"value": "vitrinnea-dev-secret-key-2025",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"external_id\": \"test-user-001\",\n  \"name\": \"Test User\",\n  \"email\": \"testuser@vitrinnea.com\",\n  \"country\": \"SV\",\n  \"allowed_countries\": [\"SV\", \"GT\"],\n  \"role\": \"employee\",\n  \"user_type\": \"employee\",\n  \"active\": true\n}"
				},
				"url": {
					"raw": "http://localhost:8000/api/sync/user",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "8000",
					"path": [
						"api",
						"sync",
						"user"
					]
				},
				"description": "Creates a new user with external_id. Should return 201 Created."
			},
			"response": []
		},
		{
			"name": "Sync User - Update Existing",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"if (pm.response.code === 200) {",
							"    var jsonData = pm.response.json();",
							"    if (jsonData.success && jsonData.data.access_token) {",
							"        pm.environment.set(\"jwt_token\", jsonData.data.access_token);",
							"        console.log(\"✅ Token updated:\", jsonData.data.access_token);",
							"    }",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					},
					{
						"key": "X-API-Key",
						"value": "vitrinnea-dev-api-key-2025",
						"type": "text"
					},
					{
						"key": "X-API-Secret",
						"value": "vitrinnea-dev-secret-key-2025",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"external_id\": \"test-user-001\",\n  \"name\": \"Test User Updated\",\n  \"email\": \"testuser@vitrinnea.com\",\n  \"country\": \"GT\",\n  \"allowed_countries\": [\"SV\", \"GT\", \"CR\"],\n  \"role\": \"admin_sv\",\n  \"user_type\": \"admin\",\n  \"active\": true\n}"
				},
				"url": {
					"raw": "http://localhost:8000/api/sync/user",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "8000",
					"path": [
						"api",
						"sync",
						"user"
					]
				},
				"description": "Updates existing user by external_id. Should return 200 OK."
			},
			"response": []
		},
		{
			"name": "Sync User - Admin User",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"if (pm.response.code === 201 || pm.response.code === 200) {",
							"    var jsonData = pm.response.json();",
							"    if (jsonData.success && jsonData.data.access_token) {",
							"        pm.environment.set(\"jwt_token\", jsonData.data.access_token);",
							"        console.log(\"✅ Admin token saved:\", jsonData.data.access_token);",
							"    }",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					},
					{
						"key": "X-API-Key",
						"value": "vitrinnea-dev-api-key-2025",
						"type": "text"
					},
					{
						"key": "X-API-Secret",
						"value": "vitrinnea-dev-secret-key-2025",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"external_id\": \"admin-user-456\",\n  \"name\": \"Jane Admin\",\n  \"email\": \"jane.admin@vitrinnea.com\",\n  \"country\": \"GT\",\n  \"allowed_countries\": [\"GT\", \"SV\", \"CR\", \"HN\"],\n  \"role\": \"super_admin\",\n  \"user_type\": \"admin\",\n  \"active\": true\n}"
				},
				"url": {
					"raw": "http://localhost:8000/api/sync/user",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "8000",
					"path": [
						"api",
						"sync",
						"user"
					]
				},
				"description": "Creates an admin user with super_admin role and multiple countries."
			},
			"response": []
		},
		{
			"name": "Sync User - Deactivate User",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					},
					{
						"key": "X-API-Key",
						"value": "vitrinnea-dev-api-key-2025",
						"type": "text"
					},
					{
						"key": "X-API-Secret",
						"value": "vitrinnea-dev-secret-key-2025",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"external_id\": \"test-user-001\",\n  \"name\": \"Test User\",\n  \"email\": \"testuser@vitrinnea.com\",\n  \"country\": \"SV\",\n  \"active\": false\n}"
				},
				"url": {
					"raw": "http://localhost:8000/api/sync/user",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "8000",
					"path": [
						"api",
						"sync",
						"user"
					]
				},
				"description": "Deactivates user by setting active to false."
			},
			"response": []
		},
		{
			"name": "Test Token - Get User Profile",
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{jwt_token}}",
						"type": "text"
					},
					{
						"key": "X-Country",
						"value": "SV",
						"type": "text"
					}
				],
				"url": {
					"raw": "http://localhost:8000/api/auth/me",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "8000",
					"path": [
						"api",
						"auth",
						"me"
					]
				},
				"description": "Tests if the JWT token from sync endpoint works. Uses saved token from environment."
			},
			"response": []
		},
		{
			"name": "Error Test - Missing API Key",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"name\": \"Test User\",\n  \"email\": \"test@vitrinnea.com\",\n  \"country\": \"SV\"\n}"
				},
				"url": {
					"raw": "http://localhost:8000/api/sync/user",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "8000",
					"path": [
						"api",
						"sync",
						"user"
					]
				},
				"description": "Should return 401 Unauthorized - missing API credentials."
			},
			"response": []
		},
		{
			"name": "Error Test - Invalid Email",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					},
					{
						"key": "X-API-Key",
						"value": "vitrinnea-dev-api-key-2025",
						"type": "text"
					},
					{
						"key": "X-API-Secret",
						"value": "vitrinnea-dev-secret-key-2025",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"name\": \"Test User\",\n  \"email\": \"not-an-email\",\n  \"country\": \"SV\"\n}"
				},
				"url": {
					"raw": "http://localhost:8000/api/sync/user",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "8000",
					"path": [
						"api",
						"sync",
						"user"
					]
				},
				"description": "Should return 422 Validation Error - invalid email format."
			},
			"response": []
		},
		{
			"name": "Error Test - Missing Required Fields",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					},
					{
						"key": "X-API-Key",
						"value": "vitrinnea-dev-api-key-2025",
						"type": "text"
					},
					{
						"key": "X-API-Secret",
						"value": "vitrinnea-dev-secret-key-2025",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"name\": \"Test User\"\n}"
				},
				"url": {
					"raw": "http://localhost:8000/api/sync/user",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "8000",
					"path": [
						"api",
						"sync",
						"user"
					]
				},
				"description": "Should return 422 Validation Error - missing email and country."
			},
			"response": []
		}
	]
}
